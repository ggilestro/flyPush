{% extends "base.html" %}
{% set active_page = "tenants" %}
{% block title %}Tenants{% endblock %}
{% block page_title %}Tenants ({{ data.total }}){% endblock %}

{% block content %}
<!-- Filters -->
<form method="get" action="/tenants" class="bg-white rounded-lg shadow p-4 mb-6">
    <div class="grid grid-cols-1 md:grid-cols-5 gap-3 items-end">
        <div>
            <label class="block text-xs font-medium text-gray-500 mb-1">Search</label>
            <input type="text" name="search" value="{{ filters.search }}" placeholder="Name or slug..."
                   class="w-full px-3 py-2 border border-gray-300 rounded text-sm focus:ring-amber-500 focus:border-amber-500">
        </div>
        <div>
            <label class="block text-xs font-medium text-gray-500 mb-1">Plan</label>
            <select name="plan" class="w-full px-3 py-2 border border-gray-300 rounded text-sm focus:ring-amber-500 focus:border-amber-500">
                <option value="">All Plans</option>
                <option value="light" {% if filters.plan == 'light' %}selected{% endif %}>Light</option>
                <option value="pro" {% if filters.plan == 'pro' %}selected{% endif %}>Pro</option>
                <option value="life" {% if filters.plan == 'life' %}selected{% endif %}>Life</option>
            </select>
        </div>
        <div>
            <label class="block text-xs font-medium text-gray-500 mb-1">Status</label>
            <select name="status" class="w-full px-3 py-2 border border-gray-300 rounded text-sm focus:ring-amber-500 focus:border-amber-500">
                <option value="">All Statuses</option>
                <option value="trialing" {% if filters.status == 'trialing' %}selected{% endif %}>Trialing</option>
                <option value="active" {% if filters.status == 'active' %}selected{% endif %}>Active</option>
                <option value="past_due" {% if filters.status == 'past_due' %}selected{% endif %}>Past Due</option>
                <option value="cancelled" {% if filters.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
            </select>
        </div>
        <div>
            <label class="block text-xs font-medium text-gray-500 mb-1">Country</label>
            <select name="country" class="w-full px-3 py-2 border border-gray-300 rounded text-sm focus:ring-amber-500 focus:border-amber-500">
                <option value="">All Countries</option>
                {% for c in countries %}
                <option value="{{ c }}" {% if filters.country == c %}selected{% endif %}>{{ c }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="flex gap-2">
            <button type="submit" class="px-4 py-2 bg-amber-600 text-white rounded text-sm hover:bg-amber-500 transition-colors">Filter</button>
            <a href="/tenants" class="px-4 py-2 bg-gray-200 text-gray-700 rounded text-sm hover:bg-gray-300 transition-colors">Clear</a>
        </div>
    </div>
</form>

<!-- Tenant Table -->
<div class="bg-white rounded-lg shadow overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Location</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Plan</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Users</th>
                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Stocks</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Created</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
            {% for t in data.tenants %}
            <tr class="hover:bg-gray-50 cursor-pointer" onclick="window.location='/tenants/{{ t.id }}'">
                <td class="px-4 py-3">
                    <div class="text-sm font-medium text-gray-900">{{ t.name }}</div>
                    <div class="text-xs text-gray-400">{{ t.slug }}</div>
                </td>
                <td class="px-4 py-3 text-sm text-gray-600">
                    {% if t.city %}{{ t.city }}, {% endif %}{{ t.country or '—' }}
                </td>
                <td class="px-4 py-3">
                    <span class="inline-flex px-2 py-0.5 text-xs font-medium rounded-full
                        {% if t.plan == 'life' %}bg-purple-100 text-purple-800
                        {% elif t.plan == 'pro' %}bg-amber-100 text-amber-800
                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                        {{ (t.plan or 'unknown') | upper }}
                    </span>
                </td>
                <td class="px-4 py-3">
                    <span class="inline-flex px-2 py-0.5 text-xs font-medium rounded-full
                        {% if t.subscription_status == 'active' %}bg-green-100 text-green-800
                        {% elif t.subscription_status == 'trialing' %}bg-blue-100 text-blue-800
                        {% elif t.subscription_status == 'past_due' %}bg-red-100 text-red-800
                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                        {{ (t.subscription_status or 'unknown') | replace('_', ' ') | upper }}
                    </span>
                    {% if not t.is_active %}
                    <span class="inline-flex ml-1 px-2 py-0.5 text-xs font-medium rounded-full bg-red-100 text-red-800">INACTIVE</span>
                    {% endif %}
                </td>
                <td class="px-4 py-3 text-sm text-gray-600 text-right">{{ t.user_count }}</td>
                <td class="px-4 py-3 text-sm text-gray-600 text-right">{{ t.stock_count }}</td>
                <td class="px-4 py-3 text-sm text-gray-400">{{ t.created_at[:10] if t.created_at else '—' }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="px-4 py-8 text-center text-gray-400">No tenants found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if data.pages > 1 %}
<div class="flex items-center justify-between mt-4">
    <p class="text-sm text-gray-500">
        Page {{ data.page }} of {{ data.pages }} ({{ data.total }} total)
    </p>
    <div class="flex gap-1">
        {% if data.page > 1 %}
        <a href="?page={{ data.page - 1 }}&search={{ filters.search }}&plan={{ filters.plan }}&status={{ filters.status }}&country={{ filters.country }}"
           class="px-3 py-1.5 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50">Previous</a>
        {% endif %}
        {% if data.page < data.pages %}
        <a href="?page={{ data.page + 1 }}&search={{ filters.search }}&plan={{ filters.plan }}&status={{ filters.status }}&country={{ filters.country }}"
           class="px-3 py-1.5 text-sm bg-white border border-gray-300 rounded hover:bg-gray-50">Next</a>
        {% endif %}
    </div>
</div>
{% endif %}
{% endblock %}
